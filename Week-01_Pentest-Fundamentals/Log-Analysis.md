# Log Analysis Like a Pro  
**Pentest Fundamentals – Week 1**

## Badge Earned  
Pentest Fundamentals – Skill Achieved (via Virtual Labs from DESEC)

---

## Setup and Initial Inspection

First, download the log file:

```bash
wget http://businesscorp.com.br/access.log
```

View its contents:

```bash
cat access.log
```

Check how many lines the log file contains:

```bash
wc -l access.log
```

---

## Understanding the Log Format

Before analyzing any log file, it is crucial to understand its format.

To view the first line of the log file:

```bash
head -n1 access.log
```

Example output:

```
182.118.53.93 - - [08/Feb/2015:08:10:21 -0200] "GET / HTTP/1.1" 200 2477 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2251.0 Safari/537.36"
```

Structure:
- IP Address
- Timestamp
- HTTP Request
- Response Status
- User Agent

---

## Extracting Unique IPs

List all unique IP addresses:

```bash
cat access.log | cut -d " " -f 1 | sort -u
```

Count how many times each IP appears:

```bash
cat access.log | cut -d " " -f 1 | sort | uniq -c
```

Sort by frequency (ascending):

```bash
cat access.log | cut -d " " -f 1 | sort | uniq -c | sort -un
```

Example result:

```
37038  177.138.28.7
  161  189.36.234.53
   49  187.101.118.104
   45  191.181.5.157
   32  199.193.251.194
   31  85.236.52.212
   29  187.38.19.108
   26  201.46.150.143
   25  177.94.112.125
   24  187.75.38.126
   13  119.37.196.120
    6  199.180.112.34
    5  62.210.74.47
    2  128.61.240.66
    1  109.122.33.112
```

---

## Investigating a Suspicious IP

Based on the data, the IP `177.138.28.7` appears highly suspicious due to its extremely high request volume.

To analyze its behavior:

```bash
cat access.log | grep "177.138.28.7"
```

To limit results for readability:

```bash
cat access.log | grep "177.138.28.7" | head -n500
```

Check the first and last occurrence:

```bash
cat access.log | grep "177.138.28.7" | head -n1
cat access.log | grep "177.138.28.7" | tail -n1
```

Example entries:

```
177.138.28.7 - - [13/Feb/2015:01:33:31 -0200] "GET / HTTP/1.1" 200 7117 "-" "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b1) Gecko/20081007 Firefox/3.0"
177.138.28.7 - - [13/Feb/2015:01:38:29 -0200] "GET /robots.txt HTTP/1.1" 404 489 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; http://nmap.org/book/nse.html)"
177.138.28.7 - - [13/Feb/2015:01:38:29 -0200] "GET /.git/HEAD HTTP/1.1" 404 488 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; http://nmap.org/book/nse.html)"
```

---

## Detecting Scanning Tools

The User-Agent field reveals tool usage. For example, `Nmap Scripting Engine`.

To search for specific tools:

```bash
cat access.log | grep "177.138.28.7" | grep "Nmap"
```

This technique can be used to detect other tools like `Nikto`, `DirBuster`, etc.

---

## Summary

In this module, we:

- Parsed and understood access log structure
- Extracted and analyzed IP addresses
- Identified a suspicious IP based on request volume
- Inspected specific activities from that IP
- Detected scanning tools using User-Agent patterns
